<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contributors - VS Code Contributors</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav>
        <a href="/" class="nav-brand">
            <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="100" height="100"><path fill-rule="evenodd" clip-rule="evenodd" d="M70.912 99.317a6.85 6.85 0 0 0 4.97-.642l20.159-10.216A6.86 6.86 0 0 0 99.717 82.5V17.5a6.859 6.859 0 0 0-3.676-5.96L75.882 1.325a6.852 6.852 0 0 0-7.81 1.074l-43.34 39.58L10.47 30.32a4.574 4.574 0 0 0-5.833.393L.673 34.542a4.573 4.573 0 0 0-.005 6.588l12.36 11.345L.668 63.82a4.573 4.573 0 0 0 .005 6.588l3.964 3.83a4.573 4.573 0 0 0 5.833.392l14.261-11.66 43.34 39.582a6.844 6.844 0 0 0 2.841 1.765ZM75.025 27.18 45.011 50l30.014 22.82V27.18Z" fill="#fff"/></mask><g mask="url(#a)"><path d="M96.041 11.54 75.882 1.325a6.856 6.856 0 0 0-7.81 1.074L.668 58.862a4.573 4.573 0 0 0 .005 6.588l3.964 3.83a4.573 4.573 0 0 0 5.833.392L96.21 7.124A4.573 4.573 0 0 0 96.04 11.54Z" fill="#0065A9"/><g filter="url(#b)"><path d="M96.041 88.46 75.882 98.675a6.856 6.856 0 0 1-7.81-1.074L.668 41.138a4.573 4.573 0 0 1 .005-6.588l3.964-3.83a4.573 4.573 0 0 1 5.833-.392l85.74 62.548a4.573 4.573 0 0 1-.17 4.584Z" fill="#007ACC"/></g><g filter="url(#c)"><path d="M75.882 98.675A6.849 6.849 0 0 1 68.072 97.6a5.26 5.26 0 0 0 3.602 2.117 5.26 5.26 0 0 0 4.021-1.01l20.16-10.216a6.857 6.857 0 0 0 3.675-5.96V17.5a6.857 6.857 0 0 0-3.676-5.96L75.695 1.326A5.257 5.257 0 0 0 68.072 2.4 6.849 6.849 0 0 1 75.882 1.3l20.16 10.216A6.86 6.86 0 0 1 99.716 17.5v65a6.86 6.86 0 0 1-3.676 5.96l-20.159 10.215Z" fill="#1F9CF0"/></g><g opacity=".25"><path fill-rule="evenodd" clip-rule="evenodd" d="M70.852 99.317a6.851 6.851 0 0 0 4.97-.642l20.159-10.216a6.86 6.86 0 0 0 3.676-5.96V17.5a6.859 6.859 0 0 0-3.676-5.96L75.822 1.326a6.852 6.852 0 0 0-7.81 1.074L24.673 41.98 10.41 30.32a4.574 4.574 0 0 0-5.833.393L.613 34.542a4.573 4.573 0 0 0-.005 6.588l12.36 11.345-12.36 11.345a4.573 4.573 0 0 0 .005 6.588l3.964 3.83a4.573 4.573 0 0 0 5.833.392l14.262-11.66 43.339 39.582a6.845 6.845 0 0 0 2.841 1.765Zm4.113-72.137L44.951 50l30.014 22.82V27.18Z" fill="url(#d)"/></g></g><defs><filter id="b" x="-8.398" y="22.654" width="115.504" height="84.092" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="A"/><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="B"/><feOffset/><feGaussianBlur stdDeviation="4.167"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/><feBlend in2="A" result="C"/><feBlend in="SourceGraphic" in2="C"/></filter><filter id="c" x="60.427" y="-6.746" width="47.289" height="113.492" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="A"/><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="B"/><feOffset/><feGaussianBlur stdDeviation="4.167"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/><feBlend in2="A" result="C"/><feBlend in="SourceGraphic" in2="C"/></filter><linearGradient id="d" x1="49.948" y1=".823" x2="49.948" y2="99.137" gradientUnits="userSpaceOnUse"><stop stop-color="#fff"/><stop offset="1" stop-color="#fff" stop-opacity="0"/></linearGradient></defs></svg>
            <span>VS Code Contributors</span>
        </a>
        <a href="/" class="nav-link">Home</a>
        <a href="/contributors" class="nav-link active">Contributors</a>
        <a href="/about" class="nav-link">About</a>
        <span class="spacer"></span>
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
            <span id="theme-icon">‚òÄÔ∏è</span> <span id="theme-label">Light</span>
        </button>
    </nav>

    <main class="wide">
        <div class="contributors-header">
            <h1>Contributors</h1>
            {{if not .Loading}}
            <div class="release-selector">
                <label for="release-select">Release</label>
                <select id="release-select" onchange="window.location.href='/contributors?version=' + this.value">
                    {{range .Versions}}
                    <option value="{{.ID}}" {{if .Selected}}selected{{end}}>v{{.Display}}</option>
                    {{end}}
                </select>
            </div>
            {{end}}
        </div>

        {{if .Loading}}
        <div class="loading-msg">
            <div class="loading-spinner"></div>
            <p>Fetching contributor data from VS Code release notes&hellip;</p>
            <p>Please refresh the page in a moment.</p>
        </div>
        {{else if .Contributors}}
        <p class="contributor-count"><strong>{{len .Contributors}}</strong> contributors in v{{.Selected}}</p>
        <div class="contributors">
            {{range .Contributors}}
            <div class="contributor-card reveal">
                <div class="card-header">
                    <img src="{{.AvatarURL}}" alt="{{.Name}}" class="avatar" loading="lazy">
                    <div class="card-info">
                        <h2>{{.Name}}</h2>
                        <a href="https://github.com/{{.GitHubUser}}" class="github-handle" target="_blank" rel="noopener">@{{.GitHubUser}}</a>
                    </div>
                </div>
                {{if .PRs}}
                <div class="prs">
                    {{range .PRs}}
                    <div class="pr-item">
                        <a href="{{.URL}}" target="_blank" rel="noopener">PR #{{.Number}}</a>
                        {{if .Title}}<span class="pr-title">{{.Title}}</span>{{end}}
                    </div>
                    {{end}}
                </div>
                {{end}}
                <button class="kudos-btn" data-user="{{.GitHubUser}}" onclick="sendKudos(this)">
                    <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M7.655 14.916v-.001h-.002l-.006-.003-.018-.01a22 22 0 01-.306-.17 27.4 27.4 0 01-3.535-2.44C2.088 10.882.5 8.992.5 6.5a4.5 4.5 0 017.5-3.35A4.5 4.5 0 0115.5 6.5c0 2.492-1.588 4.382-3.288 5.792a27.4 27.4 0 01-3.842 2.611l-.018.01-.006.003h-.002z"/></svg>
                    <span class="kudos-count">{{.Kudos}}</span>
                </button>
            </div>
            {{end}}
        </div>
        {{else}}
        <p>No contributor data available for this release.</p>
        {{end}}

        <section class="ask-copilot">
            <h2>Ask Copilot</h2>
            <p class="ask-subtitle">Ask natural-language questions about VS Code contributors, releases, and PRs.</p>
            <form id="ask-form" onsubmit="return askCopilot(event)">
                <div class="ask-input-row">
                    <input type="text" id="ask-input" placeholder="e.g. Who contributed the most PRs in the last 3 releases?" autocomplete="off" required>
                    <button type="submit" class="btn btn-primary" id="ask-btn">Ask</button>
                </div>
            </form>
            <div id="ask-result" class="ask-result" hidden>
                <div id="ask-answer"></div>
            </div>
            <div id="ask-loading" class="ask-loading" hidden>
                <span class="spinner"></span> Thinking&hellip;
            </div>
            <div id="ask-error" class="ask-error" hidden></div>
        </section>
    </main>

    <footer>
        <div class="footer-inner">
            <div class="footer-left">
                <span class="status-dot"></span>
                <span>Built with care</span>
            </div>
            <div class="footer-right">
                Data sourced from <a href="https://code.visualstudio.com/updates" target="_blank" rel="noopener">VS Code Release Notes</a>
            </div>
        </div>
    </footer>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            updateToggleUI(next);
        }
        function updateToggleUI(theme) {
            document.getElementById('theme-icon').textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            document.getElementById('theme-label').textContent = theme === 'light' ? 'Dark' : 'Light';
        }
        (function() {
            const saved = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', saved);
            updateToggleUI(saved);
        })();

        // Scroll reveal with IntersectionObserver
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.05, rootMargin: '0px 0px -20px 0px' });

        document.querySelectorAll('.reveal').forEach((el, i) => {
            el.style.transitionDelay = (i * 0.04) + 's';
            observer.observe(el);
        });

        async function sendKudos(btn) {
            const user = btn.dataset.user;
            try {
                const resp = await fetch('/api/kudos/' + encodeURIComponent(user), { method: 'POST' });
                if (resp.ok) {
                    const data = await resp.json();
                    btn.querySelector('.kudos-count').textContent = data.count;
                    btn.classList.add('kudos-clicked');
                    setTimeout(() => btn.classList.remove('kudos-clicked'), 400);
                }
            } catch (e) {
                console.error('Kudos error:', e);
            }
        }

        async function askCopilot(e) {
            e.preventDefault();
            const input = document.getElementById('ask-input');
            const query = input.value.trim();
            if (!query) return false;

            const resultEl = document.getElementById('ask-result');
            const answerEl = document.getElementById('ask-answer');
            const loadingEl = document.getElementById('ask-loading');
            const errorEl = document.getElementById('ask-error');
            const btn = document.getElementById('ask-btn');

            resultEl.hidden = true;
            errorEl.hidden = true;
            loadingEl.hidden = false;
            btn.disabled = true;

            try {
                const resp = await fetch('/api/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query }),
                });
                if (!resp.ok) {
                    const text = await resp.text();
                    throw new Error(text || 'Request failed');
                }
                const data = await resp.json();
                answerEl.textContent = data.answer || 'No answer received.';
                resultEl.hidden = false;
            } catch (err) {
                errorEl.textContent = 'Error: ' + err.message;
                errorEl.hidden = false;
            } finally {
                loadingEl.hidden = true;
                btn.disabled = false;
            }
            return false;
        }
    </script>
</body>
</html>
